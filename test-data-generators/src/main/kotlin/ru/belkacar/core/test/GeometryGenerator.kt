package ru.belkacar.core.test

import org.locationtech.jts.geom.Geometry
import org.locationtech.jts.io.geojson.GeoJsonReader

class GeometryGenerator : ObjectGenerator<Geometry> {
    private var geometryType: GeometryType = GeometryType.DEFAULT

    private val defaultPolygon = """
        {
            "type": "Polygon",
            "coordinates": [
                [
                    [
                        37.559165954589844,
                        55.7309766355099
                    ],
                    [
                        37.69477844238281,
                        55.72846342126635
                    ],
                    [
                        37.70061492919922,
                        55.78217228729694
                    ],
                    [
                        37.56156921386719,
                        55.78352371436103
                    ],
                    [
                        37.559165954589844,
                        55.7309766355099
                    ]
                ]
                ]
            }
    """.trimIndent()

    private val moscow = """
        {
        "type": "Polygon",
        "coordinates": [
          [
            [
              37.3699951171875,
              55.78738467626539
            ],
            [
              37.363128662109375,
              55.74566603524846
            ],
            [
              37.37274169921875,
              55.71628170645908
            ],
            [
              37.398834228515625,
              55.696163893908825
            ],
            [
              37.407073974609375,
              55.67681007438944
            ],
            [
              37.50457763671875,
              55.593867449197575
            ],
            [
              37.5897216796875,
              55.572910249857465
            ],
            [
              37.667999267578125,
              55.5666985605045
            ],
            [
              37.750396728515625,
              55.598523085310276
            ],
            [
              37.84515380859374,
              55.6551224230224
            ],
            [
              37.830047607421875,
              55.691519850785426
            ],
            [
              37.841033935546875,
              55.71164005362048
            ],
            [
              37.846527099609375,
              55.76189525593947
            ],
            [
              37.841033935546875,
              55.83060131378955
            ],
            [
              37.739410400390625,
              55.879933023171844
            ],
            [
              37.70439147949219,
              55.8961063462305
            ],
            [
              37.662506103515625,
              55.89726132569528
            ],
            [
              37.629547119140625,
              55.90188089972751
            ],
            [
              37.58216857910156,
              55.91381225329089
            ],
            [
              37.52449035644531,
              55.90803947607086
            ],
            [
              37.46612548828125,
              55.885324879754776
            ],
            [
              37.43797302246094,
              55.881858772213135
            ],
            [
              37.41256713867187,
              55.87454041761713
            ],
            [
              37.38853454589844,
              55.85219164310742
            ],
            [
              37.393341064453125,
              55.824430445857764
            ],
            [
              37.3699951171875,
              55.78738467626539
            ]
          ]
        ]
      }
    """.trimIndent()

    private val biggerThanDefaultPolygon = """
        {
        "type": "Polygon",
        "coordinates": [
          [
            [
              37.254638671875,
              55.59076338488528
            ],
            [
              38.0841064453125,
              55.59076338488528
            ],
            [
              38.0841064453125,
              55.88763544617004
            ],
            [
              37.254638671875,
              55.88763544617004
            ],
            [
              37.254638671875,
              55.59076338488528
            ]
          ]
        ]
      }
    """.trimIndent()

    private val smallerThanDefaultPolygon = """
        {
        "type": "Polygon",
        "coordinates": [
          [
            [
              37.62169361114502,
              55.75443355110991
            ],
            [
              37.62993335723876,
              55.75443355110991
            ],
            [
              37.62993335723876,
              55.75783858380449
            ],
            [
              37.62169361114502,
              55.75783858380449
            ],
            [
              37.62169361114502,
              55.75443355110991
            ]
          ]
        ]
      }
    """.trimIndent()

    private val boobLick = """
        {
                "type": "Polygon",
                "coordinates": [
                    [
                        [37.52706027441407, 55.755151153651255],
                        [37.48998141699218, 55.73965922168283],
                        [37.48311496191406, 55.712533473263065],
                        [37.51744723730469, 55.69237066441155],
                        [37.56139254980469, 55.68461295597482],
                        [37.64653659277343, 55.675301665392965],
                        [37.705588106445305, 55.69857571830571],
                        [37.73580050878906, 55.71563451667248],
                        [37.722067598632805, 55.75127874980543],
                        [37.70421481542969, 55.78766410628874],
                        [37.65477633886719, 55.7930802842255],
                        [37.588858370117194, 55.795401271825455],
                        [37.54353976660157, 55.78921166287346],
                        [37.52706027441407, 55.755151153651255]
                    ],
                    [
                        [37.57924533300781, 55.72493616363533],
                        [37.58061862402344, 55.75127874980543],
                        [37.664389375976576, 55.75747441064754],
                        [37.67125583105469, 55.71408402587071],
                        [37.62319064550781, 55.70555522164443],
                        [37.57924533300781, 55.72493616363533]
                    ]
                ]
            }
    """.trimIndent()

    private val point = """
        {
            "type": "Point",
            "coordinates": [
                37.262015108398444,
                55.86303565487453
            ]
        }
    """.trimIndent()

    private val linestring = """
        {
            "type": "LineString",
            "coordinates": [
                [
                    37.185110811523444,
                    55.85878782891449
                ],
                [
                    37.285361055664055,
                    55.91744376349636
                ]
            ]
        }
    """.trimIndent()

    private fun decodeGeoJson(geometryJson: String): Geometry = with(GeoJsonReader()) { read(geometryJson) }


    private fun getGeo(): String = when (geometryType) {
        GeometryType.LESSER -> smallerThanDefaultPolygon
        GeometryType.BIGGER -> biggerThanDefaultPolygon
        GeometryType.DEFAULT -> defaultPolygon
        GeometryType.POINT -> point
        GeometryType.LINESTRING -> linestring
        GeometryType.PINNED_OUT -> boobLick
        GeometryType.MOSCOW -> moscow
    }

    private var geometry: () -> Geometry = { decodeGeoJson(getGeo()) }

    fun withType(geometryType: GeometryType) = apply { this.geometryType = geometryType }

    override fun generate(): Geometry = geometry()

}

enum class GeometryType {
    DEFAULT, BIGGER, LINESTRING, POINT, LESSER, PINNED_OUT, MOSCOW
}
